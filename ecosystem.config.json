{
  "apps": [{
    "name": "sistema-rifas",
    "script": "npm",
    "args": "start",
    "cwd": "/opt/sistema-rifas",
    "env": {
      "NODE_ENV": "production",
      "PORT": "3000"
    },
    "instances": "max",
    "exec_mode": "cluster",
    "watch": false,
    "max_memory_restart": "1G",
    "error_file": "/var/log/rifas/error.log",
    "out_file": "/var/log/rifas/access.log",
    "log_file": "/var/log/rifas/combined.log",
    "time": true,
    "restart_delay": 4000,
    "max_restarts": 10,
    "min_uptime": "10s",
    "autorestart": true,
    "merge_logs": true,
    "log_date_format": "YYYY-MM-DD HH:mm:ss Z",
    "source_map_support": true,
    "instance_var": "INSTANCE_ID",
    "env_development": {
      "NODE_ENV": "development",
      "PORT": "3000"
    },
    "env_staging": {
      "NODE_ENV": "staging",
      "PORT": "3000"
    },
    "env_production": {
      "NODE_ENV": "production",
      "PORT": "3000",
      "DATABASE_URL": "postgresql://usuario:password@localhost:5432/sistema_rifas",
      "JWT_SECRET": "cambia-esto-por-un-secreto-seguro"
    }
  }],
  
  "deploy": {
    "production": {
      "user": "rifas",
      "host": ["your-server-ip"],
      "ref": "origin/main",
      "repo": "https://github.com/yourusername/sistema-rifas.git",
      "path": "/opt/sistema-rifas",
      "post-deploy": "npm ci --production && npm run build && pm2 reload ecosystem.config.json --env production",
      "pre-setup": "apt update && apt install git -y"
    }
  }
}
